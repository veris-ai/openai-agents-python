---
search:
  exclude: true
---
# 複数エージェントのオーケストレーション

オーケストレーションとは、アプリ内でエージェントがどのように実行されるか、その順序、そして次に何を行うかを決定するフローを指します。エージェントをオーケストレーションする主な方法は 2 つあります。

1.  LLM に意思決定を任せる  
    これは LLM の知能を利用して計画や推論を行い、次に取るべきステップを決定します。  
2.  コードによるオーケストレーション  
    コード側でエージェントのフローを制御します。

これらのパターンは組み合わせて使用できます。それぞれに以下のようなトレードオフがあります。

## LLM を用いたオーケストレーション

エージェントとは、instructions、tools、handoffs を備えた LLM です。つまり、オープンエンドなタスクが与えられたとき、LLM はタスクを達成するための計画を自律的に立て、tools を使ってアクションを実行・データを取得し、handoffs を通じてサブエージェントにタスクを委任できます。たとえば、リサーチエージェントには次のような tools を持たせることができます。

-   Web 検索でオンライン情報を収集  
-   ファイル検索と取得で独自データや接続先を検索  
-   コンピュータ操作で PC 上のアクションを実行  
-   コード実行でデータ分析を実施  
-   計画立案やレポート作成などを得意とする専門エージェントへの handoffs  

このパターンはタスクがオープンエンドで、LLM の知能に依存したい場合に最適です。重要なポイントは次のとおりです。

1.  良いプロンプトに投資する  
    利用可能な tools、使用方法、動作パラメーターを明示します。  
2.  アプリを監視して改善する  
    問題が発生した箇所を確認し、プロンプトを繰り返し改善します。  
3.  エージェントに内省と改善を許可する  
    例としてループで実行し、自己批評させたり、エラーメッセージを渡して改善させたりします。  
4.  何でもこなせる汎用エージェントより、特定タスクに特化したエージェントを用意する  
5.  [evals](https://platform.openai.com/docs/guides/evals) に投資する  
    これによりエージェントを学習・改善し、タスク遂行能力を高められます。  

## コードによるオーケストレーション

LLM によるオーケストレーションは強力ですが、コードによるオーケストレーションは速度・コスト・性能の面でより決定論的かつ予測可能になります。代表的なパターンは次のとおりです。

-   [structured outputs](https://platform.openai.com/docs/guides/structured-outputs) を使い、コードで検査できる適切な形式のデータを生成する  
    例として、エージェントにタスクを複数のカテゴリーに分類させ、カテゴリーに応じて次のエージェントを選択します。  
-   あるエージェントの出力を次のエージェントの入力に変換して複数エージェントを連鎖させる  
    ブログ記事作成のタスクを、リサーチ → アウトライン作成 → 記事執筆 → 批評 → 改善といった一連のステップに分解できます。  
-   タスクを実行するエージェントを `while` ループで回し、別のエージェントが評価とフィードバックを行い、評価者が基準を満たしたと判断するまで繰り返す  
-   `asyncio.gather` など Python の基本コンポーネントを用いて複数エージェントを並列実行する  
    互いに依存しない複数タスクを高速に処理する際に有効です。  

[`examples/agent_patterns`](https://github.com/openai/openai-agents-python/tree/main/examples/agent_patterns) に多数の code examples があります。