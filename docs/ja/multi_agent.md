---
search:
  exclude: true
---
# 複数エージェントのオーケストレーション

オーケストレーションとは、アプリ内での エージェント のフローを指します。どの エージェント が実行されるのか、どの順序で実行されるのか、そして次に何を行うかをどのように判断するのかを決定します。エージェント をオーケストレーションする方法は主に 2 つあります:

1.  LLM に意思決定させる: LLM の知能を活用して計画・推論し、それに基づき次に取るステップを決定します。  
2.  コードでオーケストレーションする: エージェント のフローをコードで制御します。

これらのパターンは組み合わせて使用できます。それぞれにトレードオフがあり、以下で説明します。

## LLM によるオーケストレーション

エージェント とは、 instructions、 tools、 handoffs を備えた LLM です。つまり、オープンエンドなタスクが与えられた場合、LLM は自律的にタスクへの取り組み方を計画し、 tools を使ってアクションを実行してデータを取得し、 handoffs を使ってサブエージェントへタスクを委譲できます。たとえば、リサーチ用の エージェント には次のような tools を装備できます:

-   Web 検索でオンライン情報を取得  
-   ファイル検索 とリトリーバルで独自データや接続情報を検索  
-   コンピュータ操作 でコンピュータ上のアクションを実行  
-   コード実行でデータ分析を行う  
-   優れた計画立案やレポート作成を行う専門 エージェント への handoffs  

このパターンはタスクがオープンエンドで、LLM の知能に頼りたい場合に最適です。重要な戦術は次のとおりです:

1.  良いプロンプトに投資する。利用可能な tools とその使い方、そして守るべきパラメーターを明確にします。  
2.  アプリをモニタリングして反復改善する。問題が起きた箇所を確認し、プロンプトを改善します。  
3.  エージェント に内省と改善を許可する。たとえばループで実行し、自身を批評させたり、エラーメッセージを与えて改善させたりします。  
4.  何でもこなす汎用 エージェント ではなく、単一タスクに優れる専門 エージェント を用意します。  
5.  [evals](https://platform.openai.com/docs/guides/evals) に投資する。これにより エージェント を訓練し、タスク遂行能力を向上できます。  

## コードによるオーケストレーション

LLM によるオーケストレーションは強力ですが、コードでオーケストレーションすると速度・コスト・性能面でより決定論的かつ予測可能になります。一般的なパターンは次のとおりです:

-   [structured outputs](https://platform.openai.com/docs/guides/structured-outputs) を用いて、コードで検査できる 適切な形式のデータ を生成する。たとえば エージェント にタスクをいくつかの カテゴリー に分類させ、その カテゴリー に基づいて次の エージェント を選択します。  
-   複数の エージェント をチェーンし、1 つの出力を次の入力へ変換する。ブログ記事執筆のタスクを、リサーチ → アウトライン作成 → 記事執筆 → 批評 → 改善という一連のステップに分解できます。  
-   タスクを実行する エージェント を `while` ループで回し、別の エージェント が評価とフィードバックを行い、評価者が基準を満たしたと判断するまで繰り返します。  
-   `asyncio.gather` など Python の basic components を使って複数の エージェント を並列実行する。互いに依存しない複数タスクがある場合に速度向上に有効です。  

[`examples/agent_patterns`](https://github.com/openai/openai-agents-python/tree/main/examples/agent_patterns) には多数の code examples を用意しています。