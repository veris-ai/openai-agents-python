---
search:
  exclude: true
---
# 複数エージェントのオーケストレーション

オーケストレーションとは、アプリ内でエージェントがどのように流れるかを指します。どのエージェントが実行されるのか、どの順序で動くのか、次に何をするかをどう判断するのか。エージェントをオーケストレーションする方法は主に 2 つあります。

1.  LLM に意思決定を任せる方法: LLM の知性を活用して計画・推論し、その結果に基づいて次のステップを決定します。  
2.  コードによるオーケストレーション: コードでエージェントのフローを決定します。

これらのパターンは組み合わせることができ、それぞれに以下のようなトレードオフがあります。

## LLM によるオーケストレーション

エージェントとは、instructions・tools・ハンドオフを備えた LLM です。これにより、オープンエンドなタスクに対して LLM が自律的に計画を立て、tools を使ってアクションを実行しデータを取得し、ハンドオフでサブエージェントにタスクを委譲できます。たとえば、リサーチエージェントには次のような tools を装備できます。

-   Web 検索でオンライン情報を取得  
-   ファイル検索と取得で独自データや接続先を検索  
-   コンピュータ操作でコンピュータ上のアクションを実行  
-   コード実行でデータ分析を行う  
-   計画立案やレポート作成などに長けた専門エージェントへのハンドオフ  

このパターンはタスクがオープンエンドで、LLM の知性に依存したい場合に適しています。重要なポイントは次のとおりです。

1.  質の高いプロンプトに投資する。利用可能な tools・その使い方・動作パラメーターを明確に伝えます。  
2.  アプリをモニタリングして改善を繰り返す。問題が起きる箇所を確認し、プロンプトを調整します。  
3.  エージェントに内省と改善を許可する。たとえばループで実行し自己批評させる、エラーメッセージを渡して改善させるなどです。  
4.  何でもできる汎用エージェントより、一つのタスクに特化したエージェントを用意しましょう。  
5.  [evals](https://platform.openai.com/docs/guides/evals) に投資する。これによりエージェントを訓練し、タスク遂行能力を向上させられます。  

## コードによるオーケストレーション

LLM によるオーケストレーションは強力ですが、コードによるオーケストレーションは速度・コスト・パフォーマンスの面でより決定論的かつ予測可能になります。代表的なパターンは次のとおりです。

-   [structured outputs](https://platform.openai.com/docs/guides/structured-outputs) を使い、コードで検査できる適切な形式のデータを生成する。たとえば、エージェントにタスクをいくつかのカテゴリーに分類させ、そのカテゴリーに応じて次のエージェントを選択します。  
-   複数のエージェントをチェーンし、一方の出力を次の入力へ変換する。ブログ記事作成を「リサーチ→アウトライン作成→本文作成→レビュー→改善」といった一連のステップに分割できます。  
-   タスクを実行するエージェントを `while` ループで回し、評価とフィードバックを行うエージェントと組み合わせ、評価者が基準を満たしたと判断するまで繰り返す。  
-   `asyncio.gather` などの Python の基本コンポーネントを用いて複数エージェントを並列実行する。互いに依存しない複数タスクを高速に処理したいときに有効です。  

[`examples/agent_patterns`](https://github.com/openai/openai-agents-python/tree/main/examples/agent_patterns) に多数の code examples があります。