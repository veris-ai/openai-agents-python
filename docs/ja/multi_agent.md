---
search:
  exclude: true
---
# 複数エージェントのオーケストレーション

オーケストレーションとは、アプリ内でエージェントがどのように動作するか、どのエージェントがどの順序で実行されるか、そして次に何を行うかを決定する流れを指します。エージェントをオーケストレーションする方法は主に 2 つあります。

1.  LLM に意思決定を任せる方法:  LLM の知能を活用して計画・推論し、それに基づいて次のステップを決定します。  
2.  コードでオーケストレーションする方法: コードによってエージェントの流れを制御します。

これらのパターンは組み合わせて使用できます。それぞれにトレードオフがあり、以下で説明します。

## LLM によるオーケストレーション

エージェントとは、 instructions、 tools、 handoffs を備えた  LLM です。これにより、オープンエンドなタスクに対して、 LLM が自律的に計画を立て、ツールを使ってアクションを実行・データを取得し、 handoffs を使ってサブエージェントにタスクを委任できます。たとえば、リサーチエージェントには次のようなツールを装備できます。

-   Web 検索によるオンライン情報の取得  
-   ファイル検索とリトリーバルによる独自データや接続の検索  
-   コンピュータ操作による PC 上でのアクション実行  
-   コード実行によるデータ分析  
-   プランニングやレポート作成に優れた専門エージェントへの handoffs  

このパターンは、タスクがオープンエンドで  LLM の知能に依存したい場合に最適です。主な戦術は次のとおりです。

1.  良いプロンプトに投資すること。利用可能なツール、使い方、遵守すべきパラメーターを明確に示します。  
2.  アプリを監視し、改善を重ねること。問題が起こる箇所を確認し、プロンプトを反復的に改善します。  
3.  エージェントに内省と改善を許可すること。たとえばループ内で実行し、自己批評させる、あるいはエラーメッセージを提供して改善させます。  
4.  何でもこなす汎用エージェントではなく、特定タスクに特化したエージェントを用意すること。  
5.  [evals](https://platform.openai.com/docs/guides/evals) に投資すること。エージェントを訓練してタスク遂行能力を向上させられます。  

## コードによるオーケストレーション

LLM によるオーケストレーションは強力ですが、コードによるオーケストレーションは速度・コスト・パフォーマンスの面でより決定論的かつ予測しやすくなります。代表的なパターンは以下のとおりです。

-   [structured outputs](https://platform.openai.com/docs/guides/structured-outputs) を使って、コードで検査可能な適切な形式のデータを生成する。たとえば、エージェントにタスクをいくつかのカテゴリーに分類させ、そのカテゴリーに応じて次のエージェントを選択します。  
-   あるエージェントの出力を次のエージェントの入力へと変換してエージェントを連鎖させる。ブログ記事作成なら「リサーチ→アウトライン作成→記事執筆→批評→改善」のようにタスクを分解できます。  
-   タスクを実行するエージェントを `while` ループで動かし、評価とフィードバックを行うエージェントと組み合わせ、評価者が基準を満たしたと判断するまで繰り返します。  
-   複数エージェントを並列実行する。たとえば Python の basic components である `asyncio.gather` などを用います。相互依存しない複数タスクを高速に処理したい場合に有用です。  

コード例については [`examples/agent_patterns`](https://github.com/openai/openai-agents-python/tree/main/examples/agent_patterns) を参照してください。