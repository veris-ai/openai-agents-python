---
search:
  exclude: true
---
# 多数のエージェントのオーケストレーション

オーケストレーションとは、アプリ内でのエージェントの流れを指します。どのエージェントが実行されるのか、どの順番で動くのか、次に何をすべきかをどのように決定するのか、ということです。エージェントをオーケストレーションする方法は主に 2 つあります:

1. LLM に意思決定を任せる: LLM の知能を活用して計画・推論し、次に取るべきステップを決定します。  
2. コードによるオーケストレーション: コードでエージェントの流れを決定します。

これらのパターンは組み合わせて利用できます。それぞれにメリットとデメリットがあるため、以下で説明します。

## LLM によるオーケストレーション

エージェントとは、 instructions ・ tools ・ハンドオフを備えた LLM です。つまり、オープンエンドなタスクが与えられた場合、 LLM は自律的にタスクの進め方を計画し、 tools を使って行動してデータを取得し、ハンドオフを使ってサブエージェントにタスクを委任できます。たとえば、リサーチ用エージェントには次のような tools を備えられます:

- Web 検索でオンライン情報を取得  
- ファイル検索と取得により、社内データや接続先を検索  
- コンピュータ操作で PC 上のアクションを実行  
- コード実行でデータ分析を行う  
- 優れた計画立案やレポート作成などに特化したエージェントへのハンドオフ

このパターンはタスクがオープンエンドで、 LLM の知能に依存したい場合に非常に有効です。最も重要な戦術は次のとおりです。

1. 良いプロンプトに投資する。利用できる tools、使用方法、そしてどのパラメーターの範囲で動作するかを明確にします。  
2. アプリを監視して継続的に改善する。問題が発生する箇所を把握し、プロンプトを繰り返し改善します。  
3. エージェント自身に内省させて改善させる。たとえばループで実行して自己批評させたり、エラーメッセージを与えて改善させたりします。  
4. 何でもこなす汎用エージェントではなく、特定タスクに秀でた専門エージェントを用意します。  
5. [evals](https://platform.openai.com/docs/guides/evals) に投資する。これによりエージェントを訓練してタスク遂行能力を向上させられます。

## コードによるオーケストレーション

LLM によるオーケストレーションは強力ですが、コードによるオーケストレーションは速度・コスト・性能の面でより決定論的かつ予測可能になります。代表的なパターンは次のとおりです。

- structured outputs を使用して適切な形式のデータを生成し、コードで検査する。たとえば、エージェントにタスクをいくつかのカテゴリーに分類させ、そのカテゴリーに応じて次のエージェントを選択します。  
- 複数のエージェントを連鎖させ、一方の出力を次の入力に変換する。たとえばブログ記事を書くタスクを、リサーチ、アウトライン作成、本文執筆、批評、改善という一連のステップに分割できます。  
- タスクを実行するエージェントを `while` ループで回し、評価とフィードバックを行うエージェントと組み合わせ、評価者が基準を満たしたと判断するまで繰り返します。  
- `asyncio.gather` のような Python の基本コンポーネントを使って複数のエージェントを並列実行する。相互に依存しないタスクが複数ある場合、速度向上に有効です。  

[`examples/agent_patterns`](https://github.com/openai/openai-agents-python/tree/main/examples/agent_patterns) には多数の code examples を用意しています。