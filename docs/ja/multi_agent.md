---
search:
  exclude: true
---
# 複数のエージェントのオーケストレーション

オーケストレーションとは、アプリ内でエージェントがどのように動き、どの順序で実行され、次に何をするかを決定する流れを指します。エージェントをオーケストレーションする方法は主に 2 つあります。

1.  LLM に判断させる:  LLM の知能を活用して計画・推論を行い、その結果に基づいて次のステップを決定します。  
2.  code でオーケストレーションする: コードでエージェントの流れを決定します。

これらのパターンは組み合わせて使うこともできます。それぞれにトレードオフがあるため、以下で説明します。

## LLM によるオーケストレーション

エージェントは instructions、tools、handoffs を備えた  LLM です。つまり、オープンエンドなタスクが与えられた場合、 LLM はツールを使ってアクションを実行しデータを取得し、handoffs でサブエージェントへ委譲しながら、自律的にタスクへの取り組み方を計画できます。たとえば、リサーチを行うエージェントには次のようなツールを持たせられます。

-   Web 検索でオンライン情報を見つける  
-   ファイル検索と取得で独自データや接続を検索する  
-   コンピュータ操作でコンピュータ上の操作を実行する  
-   コード実行でデータ分析を行う  
-   計画立案やレポート作成などに優れた専門エージェントへの handoffs  

このパターンはタスクがオープンエンドで、 LLM の知能に依存したい場合に最適です。重要なポイントは次のとおりです。

1.  良いプロンプトに投資する。利用可能なツール、その使い方、そして遵守すべきパラメーターを明確に示します。  
2.  アプリをモニタリングして改善を重ねる。問題が発生した箇所を確認し、プロンプトを改良します。  
3.  エージェントに内省と改善をさせる。たとえばループで実行し自己批評させたり、エラーメッセージを渡して改善させたりします。  
4.  なんでもこなす汎用エージェントより、特定タスクに特化したエージェントを用意します。  
5.  [evals](https://platform.openai.com/docs/guides/evals) に投資する。これによりエージェントを訓練し、タスク遂行能力を向上させられます。  

## code によるオーケストレーション

LLM によるオーケストレーションは強力ですが、code でオーケストレーションすると速度・コスト・性能の面でより決定論的かつ予測可能になります。代表的なパターンは次のとおりです。

-   [structured outputs](https://platform.openai.com/docs/guides/structured-outputs) を使って、コードで検査できる適切な形式のデータを生成する。たとえば、エージェントにタスクをいくつかのカテゴリーに分類させ、そのカテゴリーに基づいて次のエージェントを選ぶ方法があります。  
-   複数のエージェントをチェーンし、一方の出力を次の入力へ変換する。ブログ記事作成を「リサーチ → アウトライン作成 → 本文作成 → 批評 → 改善」のような一連のステップに分解できます。  
-   タスクを実行するエージェントを `while` ループで回し、評価とフィードバックを行うエージェントとセットで動かし、評価者が基準を満たすと判断するまで繰り返す。  
-   `asyncio.gather` などの Python プリミティブを用いて複数のエージェントを並列実行する。互いに依存しない複数タスクがある場合に速度面で有効です。  

[`examples/agent_patterns`](https://github.com/openai/openai-agents-python/tree/main/examples/agent_patterns) に複数の code examples を用意しています。